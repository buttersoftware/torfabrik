{% extends 'pspiessLetsplayBundle::layout.html.twig' %}

{% block title %}Reservierungen{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('resources/css/jquery-ui.min.css') }}" rel="stylesheet">
    <link href="{{ asset('resources/css/jquery-ui.custom.min.css') }}" rel="stylesheet">
    <link href="{{ asset('resources/css/fullcalendar.css') }}" rel="stylesheet">
    <link href="{{ asset('resources/css/datepicker.css') }}" rel="stylesheet">
{% endblock %}

{% block nav %}
    {{ knp_menu_render('pspiessLetsplayBundle:MenuBuilder:mainMenu', {'currentClass': 'active', 'template': 'pspiessLetsplayBundle:Menu:knp_menu.html.twig'}) }}
{% endblock %}

{% block body -%}
    <div class="page-content-area">
        <div class="page-header">
        </div>
        <div class="col-lg-12" style="padding-bottom:5px;">
            <div class="col-lg-6">
                <div class="btn-group">
                    <button type="button" id="previousday" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-left"> Tag</i></button>
                    <button type="button" id="previousweek" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-left"> Woche</i></button>
                    <button type="button" id="previousmonth" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-left"> Monat</i></button>
                </div>
                <div class="btn-group">
                    <input class="input-medium date-picker" id="date-picker" type="text" data-date-format="dd-mm-yyyy"/>
                </div>
                <div class="btn-group">
                    <button type="button" id="nextmonth" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-right"> Monat</i></button>
                    <button type="button" id="nextweek" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-right"> Woche</i></button>
                    <button type="button" id="nextday" class="btn btn-medium btn-white btn-primary"><i
                                class="ace-icon fa fa-angle-double-right"> Tag</i></button>
                </div>
            </div>
            <div class="col-lg-6">
                <span class="label label-lg label-info">reserviert</span>
                <span class="label label-lg label-danger">nicht bezahlt</span>
                <span class="label label-lg label-success">bezahlt</span>
                <span class="label label-lg label-warning">storniert</span>
            </div>
        </div>
        <div class="col-xs-12">
            <div class="col-lg-3">
                <span class="label label-lg label-info arrowed-right">Platz 1</span>
                <span class="label label-lg label-yellow arrowed-in">5er Court</span>

                <div class="space"></div>
                <div id="load1" style="position:fixed; z-index: 2000; padding-top: 10%; padding-left: 10%;"
                     class="ajax-loading-overlay">
                    <i class="ajax-loading-icon fa fa-spin fa-spinner fa-5x orange"></i>
                </div>
                <div id="calendar1" class="calendar" style="height: 500px"></div>
                <div></div>
            </div>
            <div class="col-sm-3">
                <span class="label label-lg label-info arrowed-right">Platz 2</span>
                <span class="label label-lg label-yellow arrowed-in">5er Court</span>

                <div class="space"></div>
                <div id="load2" style="position:fixed; z-index: 2000; padding-top: 10%; padding-left: 10%;"
                     class="ajax-loading-overlay">
                    <i class="ajax-loading-icon fa fa-spin fa-spinner fa-5x orange"></i>
                </div>
                <div id="calendar2" class="calendar"></div>
            </div>
            <div class="col-sm-3">
                <span class="label label-lg label-info arrowed-right">Platz 3</span>
                <span class="label label-lg label-yellow arrowed-in">4er Court</span>

                <div class="space"></div>
                <div id="load3" style="position:fixed; z-index: 2000; padding-top: 10%; padding-left: 10%;"
                     class="ajax-loading-overlay">
                    <i class="ajax-loading-icon fa fa-spin fa-spinner fa-5x orange"></i>
                </div>
                <div id="calendar3" class="calendar"></div>
            </div>
            <div class="col-sm-3">
                <span class="label label-lg label-info arrowed-right">Platz 4</span>
                <span class="label label-lg label-yellow arrowed-in">4er Court</span>

                <div class="space"></div>
                <div id="load4" style="position:fixed; z-index: 2000; padding-top: 10%; padding-left: 10%;"
                     class="ajax-loading-overlay">
                    <i class="ajax-loading-icon fa fa-spin fa-spinner fa-5x orange"></i>
                </div>
                <div id="calendar4" class="calendar"></div>
            </div>
        </div>
        <!-- /.col -->
    </div>
    <div id="dialog-message" class="hide">
        <form>
            <div class="col-md-12">
                <div class="form-group">
                    <label for="customer">Kunde</label>
                    <input id="customer" class="title input-xxlarge" type="text" class="form-control"
                           autocomplete="On"/>
                    <input type="hidden" name="customer_id" id="customer_id"/>
                </div>
            </div>
            <div class="col-md-8">
                <div class="form-group">
                    <select id="category_id" name="category">
                        <option name="category" value=""> Normalbuchung</option>
                        {% for row in category %}
                            <option name="{{ row.acronym }}" value="{{ row.id }}"> {{ row.description }} </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-8">
                <select id="serial" name="serial">
                    <option name="day" value="0"> einmalig</option>
                    <option name="week" value="1"> jede Woche</option>
                    <option name="2week" value="2"> jede 2te Woche</option>
                    <option name="month" value="3"> jeden Monat</option>
                </select>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <input class="form-control date-picker" id="serial_date" type="text" data-date-format="dd.mm.yyyy"/>
                    <span class="input-group-addon">
                        <i class="fa fa-calendar bigger-110"></i>
                    </span>
                </div>
            </div>
        </form>
    </div>
    {% include "pspiessLetsplayBundle:Customer:newprompt.html.twig" %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <style>
        .ui-autocomplete {
            max-height: 100px;
            overflow-y: auto;
            /* prevent horizontal scrollbar */
            overflow-x: hidden;
        }

        /* IE 6 doesn't support max-height
         * we use height instead, but this forces the menu to always be this tall
         */
        * html .ui-autocomplete {
            height: 100px;
        }
    </style>
    <script src="{{ asset('resources/js/ace-extra.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/jquery-ui.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/jquery-ui.custom.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/jquery.ui.touch-punch.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/date-time/moment.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/date-time/bootstrap-datepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/fullcalendar/fullcalendar.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/fullcalendar/lang/de.js') }}" type="text/javascript"></script>
    <script src="{{ asset('resources/js/bootbox.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
    {#<script src="{{ asset('resources/js/date-time/locales/bootstrap-datepicker.de.js')}}" type="text/javascript"></script>#}
    {#<div class="spinner" ng-show="loading"></div>#}
    {{ include('pspiessLetsplayBundle:Booking:calendar.html.twig') }}
    <script type="text/javascript">
    jQuery(function ($) {
        //DateTime
        $('.date-picker').datepicker({
            autoclose: true,
            todayHighlight: true,
            format: 'dd.mm.yyyy'
        });

        $('#date-picker').change(function () {
            var arrDate = $(this).val().toString().split('.');
            $('.calendar').fullCalendar('gotoDate', arrDate[2] + '-' + arrDate[1] + '-' + arrDate[0]);
        });
        $('#nextday').click(function () {
            $('.calendar').fullCalendar('incrementDate', {days: 1});
        });
        $('#nextweek').click(function () {
            $('.calendar').fullCalendar('incrementDate', {days: 7});
        });
        $('#nextmonth').click(function () {
            $('.calendar').fullCalendar('incrementDate', {months: 1});
        });
        $('#previousday').click(function () {
            $('.calendar').fullCalendar('incrementDate', {days: -1});
        });
        $('#previousweek').click(function () {
            $('.calendar').fullCalendar('incrementDate', {days: -7});
        });
        $('#previousmonth').click(function () {
            $('.calendar').fullCalendar('incrementDate', {months: -1});
        });

        var arrSource = [];
        var mapping = {};
        $("#customer").autocomplete({
            appendTo: "#dialog-message", //problems with z-index
            source: function (request, response) {
                var keyword = $("#customer").val();
                arrSource = [];
                mapping = {};
                $.ajax({
                    url: Routing.generate('pspiess_letsplay_customer_get', {keyword: keyword}),
                    type: 'POST',
                    success: function (data) {
                        for (var i = 0; i < data.length; ++i) {
                            arrSource.push(data[i].label);
                            mapping[data[i].label] = data[i].value;
                        }
                        response(arrSource);
                        //response(arrSource.slice(0, 10));
                    }
                });
            },
            select: function (event, ui) {
                $('#customer_id').val(mapping[ui.item.value]);
                $("#add_reservation").removeAttr("disabled");
            },
            change: function (event, ui) {
                if (!ui.item) {
                    $("#add_reservation").attr("disabled", "disabled");
                    $(this).val('');
                } else {
                    $("#add_reservation").removeAttr("disabled");
                }
            },
            minLength: 3
        });

        var calendar = $('#calendar1').fullCalendar({
            defaultView: 'agendaDay',
            lang: 'de',
            minTime: "10:00:00",
            //isRTL: true,
            allDaySlot: false,
            height: 650,
            buttonHtml: {
                prev: '<i class="ace-icon fa fa-chevron-left"></i>',
                next: '<i class="ace-icon fa fa-chevron-right"></i>'
            },
            header: {
                left: 'title',
                center: '',
                right: 'today prev,next'
            },
            loading: function (bool) {
                if (bool) {
                    $("#load1").show();
                }
                else {
                    $("#load1").hide();
                }
            },
            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: Routing.generate('pspiess_letsplay_booking_calendar', {
                        id: 30,
                        date: start.format("YYYY-MM-DD")
                    }),
                    type: 'POST',
                    success: function (response) {
                        callback(response);
                    }
                });
            },
            droppable: true, // this allows things to be dropped onto the calendar !!!
            selectable: true,
            selectHelper: true,
            select: function (start, end) {
                showDialog(start.format("YYYY-MM-DD HH:mm:ss"), end.format("YYYY-MM-DD HH:mm:ss"), 30, '#calendar1');
            },
            editable: true,
            eventDrop: function (event, delta) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventResize: function (event) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventClick: function (calEvent, jsEvent, view) {
                $('#category_id option[value="' + calEvent.categoryid + '"]').attr('selected', true);
                showChangeDialog(calEvent.start.format("YYYY-MM-DD HH:mm:ss"), calEvent.end.format("YYYY-MM-DD HH:mm:ss"), 30, calendar, calEvent.id);
            }
        });

        var calendar1 = $('#calendar2').fullCalendar({
            defaultView: 'agendaDay',
            lang: 'de',
            minTime: "10:00:00",
            //isRTL: true,
            allDaySlot: false,
            height: 650,
            buttonHtml: {
                prev: '<i class="ace-icon fa fa-chevron-left"></i>',
                next: '<i class="ace-icon fa fa-chevron-right"></i>'
            },
            header: {
                left: 'title',
                center: '',
                right: 'today prev,next'
            },
            loading: function (bool) {
                if (bool) {
                    $("#load2").show();
                }
                else {
                    $("#load2").hide();
                }
            },
            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: Routing.generate('pspiess_letsplay_booking_calendar', {
                        id: 31,
                        date: start.format("YYYY-MM-DD")
                    }),
                    type: 'POST',
                    success: function (response) {
                        callback(response);
                    }
                });
            },
            droppable: true, // this allows things to be dropped onto the calendar !!!
            selectable: true,
            selectHelper: true,
            select: function (start, end) {
                showDialog(start.format("YYYY-MM-DD HH:mm:ss"), end.format("YYYY-MM-DD HH:mm:ss"), 31, '#calendar2');
            },
            editable: true,
            eventDrop: function (event, delta) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventResize: function (event) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventClick: function (calEvent, jsEvent, view) {
                $('#category_id option[value="' + calEvent.categoryid + '"]').attr('selected', true);
                showChangeDialog(calEvent.start.format("YYYY-MM-DD HH:mm:ss"), calEvent.end.format("YYYY-MM-DD HH:mm:ss"), 31, calendar1, calEvent.id);
            }
        });

        var calendar2 = $('#calendar3').fullCalendar({
            defaultView: 'agendaDay',
            lang: 'de',
            minTime: "10:00:00",
            //isRTL: true,
            allDaySlot: false,
            height: 650,
            buttonHtml: {
                prev: '<i class="ace-icon fa fa-chevron-left"></i>',
                next: '<i class="ace-icon fa fa-chevron-right"></i>'
            },
            header: {
                left: 'title',
                center: '',
                right: 'today prev,next'
            },
            loading: function (bool) {
                if (bool) {
                    $("#load3").show();
                }
                else {
                    $("#load3").hide();
                }
            },
            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: Routing.generate('pspiess_letsplay_booking_calendar', {
                        id: 28,
                        date: start.format("YYYY-MM-DD")
                    }),
                    type: 'POST',
                    success: function (response) {
                        callback(response);
                    }
                });
            },
            droppable: true, // this allows things to be dropped onto the calendar !!!
            selectable: true,
            selectHelper: true,
            select: function (start, end) {
                showDialog(start.format("YYYY-MM-DD HH:mm:ss"), end.format("YYYY-MM-DD HH:mm:ss"), 28, '#calendar3');
            },
            editable: true,
            eventDrop: function (event, delta) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventResize: function (event) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventClick: function (calEvent, jsEvent, view) {
                $('#category_id option[value="' + calEvent.categoryid + '"]').attr('selected', true);
                showChangeDialog(calEvent.start.format("YYYY-MM-DD HH:mm:ss"), calEvent.end.format("YYYY-MM-DD HH:mm:ss"), 28, calendar2, calEvent.id);
            }
        });
        var calendar3 = $('#calendar4').fullCalendar({
            defaultView: 'agendaDay',
            lang: 'de',
            minTime: "10:00:00",
            //isRTL: true,
            allDaySlot: false,
            height: 650,
            buttonHtml: {
                prev: '<i class="ace-icon fa fa-chevron-left"></i>',
                next: '<i class="ace-icon fa fa-chevron-right"></i>'
            },
            header: {
                left: 'title',
                center: '',
                right: 'today prev,next'
            },
            loading: function (bool) {
                if (bool) {
                    $("#load4").show();
                }
                else {
                    $("#load4").hide();
                }
            },
            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: Routing.generate('pspiess_letsplay_booking_calendar', {
                        id: 29,
                        date: start.format("YYYY-MM-DD")
                    }),
                    type: 'POST',
                    success: function (response) {
                        callback(response);
                    }
                });
            },
            editable: true,
            droppable: true, // this allows things to be dropped onto the calendar !!!
            selectable: true,
            selectHelper: true,
            select: function (start, end) {
                showDialog(start.format("YYYY-MM-DD HH:mm:ss"), end.format("YYYY-MM-DD HH:mm:ss"), 29, '#calendar4');
            },
            editable: true,
            eventDrop: function (event, delta) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventResize: function (event) {
                $.ajax({
                    url: '{{ path('pspiess_letsplay_booking_update') }}',
                    data: {
                        "start": event.start.format("YYYY-MM-DD HH:mm:ss"),
                        "end": event.end.format("YYYY-MM-DD HH:mm:ss"),
                        "id": event.id
                    },
                    type: "POST",
                    success: function (json) {
                    }
                });
            },
            eventClick: function (calEvent, jsEvent, view) {
                $('#category_id option[value="' + calEvent.categoryid + '"]').attr('selected', true);
                showChangeDialog(calEvent.start.format("YYYY-MM-DD HH:mm:ss"), calEvent.end.format("YYYY-MM-DD HH:mm:ss"), 29, calendar3, calEvent.id);
            }
        });
    })
    </script>
{% endblock %}
